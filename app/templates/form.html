<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback</title>
</head>
<body>
    <header>
        <h1 class="logo">Rock <span style="color: #1ED760;">Spoti</span>-Stats</h1>
        <div>
            <a href="/">Main</a>
            <a href="form">Feedback</a>
            <a href="analytics">Analytics</a>
            <a href="graphs">Graphs</a>
            <a href="report">Report</a>
        </div>
    </header>
    
    <main>
        <form action="">
            <label for="music-genre">Choose genre</label>
            <select name="music-genre" id="music-genre">
                <option value="alt-rock">Alt Rock</option>
                <option value="alternative">Alternative</option>
                <option value="black-metal">Black Metal</option>
                <option value="death-metal">Death Metal</option>
                <option value="emo">Emo</option>
                <option value="funk">Funk</option>
                <option value="garage">Garage</option>
                <option value="goth">Goth</option>
                <option value="grindcore">Grindcore</option>
                <option value="groove">Groove</option>
                <option value="grunge">Grunge</option>
                <option value="hard-rock">Hard Rock</option>
                <option value="heavy-metal">Heavy Metal</option>
                <option value="industrial">Industrial</option>
                <option value="j-rock">J-Rock</option>
                <option value="metal">Metal</option>
                <option value="metalcore">Metalcore</option>
                <option value="psych-rock">Psych Rock</option>
                <option value="punk">Punk</option>
                <option value="punk-rock">Punk Rock</option>
                <option value="rock">Rock</option>
                <option value="rock-n-roll">Rock-n-Roll</option>
            </select>
            <br>
    
            <label for="rate">Rate this genre from 1 to 10(float can be chosen)</label>
            <input type="number" id="rate" name="rate" max="10" min="0" step="0.1" required>
            <br>
    
            <p>Are you already 18?</p>
            <label for="yes">yes</label>
            <input type="radio" id="yes" name="age" value=true placeholder="yes" required>
            <label for="yes">no</label>
            <input type="radio" id="no" name="age" value=false placeholder="no" required>
            <br>
    
            <p>Choose tags that may describe this genre</p>
            <div>
                <input type="checkbox" id="loud" name="tag" value="loud">
                <label for="loud">Loud</label>
                <br>
                <input type="checkbox" id="energetic" name="tag" value="energetic">
                <label for="energetic">energetic</label>
                <br>
                <input type="checkbox" id="melancholic" name="tag" value="melancholic">
                <label for="melancholic">melancholic</label>
                <br>
                <input type="checkbox" id="cozy" name="tag" value="cozy">
                <label for="cozy">cozy</label>
                <br>
            </div>
            <input type="submit" value="Submit">
        </form>
    </main>
</body>
<script type="module">
    
    import { v4 as uuidv4 } from 'https://cdn.jsdelivr.net/npm/uuid@9.0.0/dist/esm-browser/index.js';

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "",
      authDomain: "",
      projectId: "",
      storageBucket: "",
      messagingSenderId: "",
      appId: ""
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const form = document.querySelector('form');

    import { getDatabase, ref, set, child } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
    const db = getDatabase();
    console.log(db);

    function PushData(data, apikey){
        set(ref(db, 'feedbacks/' + apikey), {
            genre: data['music-genre'],
            rate: data['rate'],
            age: data['age'],
            tags: data['tag']
        })
        .then(() => {
            alert('Data is pushed to the database');
        })
        .catch((error) => {
            alert('Error occured: ' + error);
        });
    }

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = {};
        let tags = []
        for (let [key, value] of formData.entries()) {
            console.log(key, value);
            if (key=="tag"){
                tags.push(value)
                data[key] = tags
            } else{
                data[key] = parseFloat(value) ? parseFloat(value) : ((value === 'true' || value === 'false') ? ((value === 'true') ? value=true : value=false) : value);
            }
        }
        console.log(data);
        let apikey = uuidv4()
        PushData(data, apikey);
        localStorage.setItem("token", apikey);
        document.cookie = `data=${JSON.stringify(data)}`;
    });
</script>
</html>